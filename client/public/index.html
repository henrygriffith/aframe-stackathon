<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>

    <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v4.0.1/dist/aframe-physics-system.min.js"></script>
    <!------------- BOUNC COMPONENT ----------------->
    <script>
        AFRAME.registerComponent('bounce', {
          init: function() {
            this.direction = 1;
            this.position = new THREE.Vector3();
            this.position.copy(this.el.object3D.position);
            setTimeout(() => {
              this.ready = true;
            }, 3000);
          },
          tick: function() {
            if (!this.ready) return;
            let position = this.el.object3D.position.y;
            if (position <= 0) {
              this.direction = 1;
            } else if (position >= 5) {
              this.direction = -1;
            }
            this.el.object3D.position.set(this.position.x, position + 0.05 * this.direction, this.position.z);
          }
        });
      </script>
    <script defer src="index.js"></script>
  </head>
  <body>
      

<!-- --------------------------------------------SCENE----------------------------------- -->

<a-scene physics="debug: false; gravity: -9.8;">
  <!-- <a-box position="-1 5 -5" rotation="0 45 0" color="#4CC3D9" shadow body="shape: box;"></a-box>
  <a-box id="target" position="1 3.75 -4" rotation="0 45 0" color="purple" shadow body="shape: box;"></a-box>
  <a-sphere position="0 10 -10" radius="1.25" color="#EF2D5E" shadow body="shape: sphere;"></a-sphere>
  <a-cone position="0 3.75 -4" radius-bottom="1.25" color="green" shadow bounce body="type: static; mass:  shape: cone; addCollideEventListener: true; collisionFlags: 4" constraint="target: #target;"></a-cone>
  <a-torus position="-1 3.75 -7" radius="1.25" scale="0.5 0.5 0.5" color="red" shadow body="shape: capsule; cylinderAxis: z;"></a-torus>
  <a-torus-knot position="0 3.75 -5" radius="1.25" scale="0.5 0.5 0.5" color="blue" shadow body="addCollideEventListener: false;"></a-torus-knot>
  <a-cylinder segments-height="1" segments-radial="10" position="1 4.0 -5" radius="0.5" height="1.5" color="#FFC65D" shadow body="shape: cylinder"></a-cylinder>
  <a-plane position="0 2 -4" rotation="90 0 0" width="1" height="1" color="#7BC8A4" shadow body="type: static; mass: 0; shape: box;"></a-plane>
  <a-torus-knot position="0 0 -7" radius="1.25" scale="5 0.1 5" rotation="0 90 0" color="#7BC8A4" shadow body="type: static; mass: 0; shape: box;"></a-torus-knot> -->
  <a-sky color="#ECECEC"></a-sky>

  <!-- <a-light intensity='0.4' type='point' color='white' position='-10 5 -5'></a-light> -->
  <a-light intensity='0.4' type='point' color='white' position='0 5 5'></a-light>
  <a-light intensity='0.4' type='point' color='white' position='-10 5 5'></a-light>
  <!-- <a-light intensity='0.4' type='point' color='white' position='0 5 -5'></a-light> -->



  <!-- CAMERA && CURSOR-->
    <a-entity camera look-controls wasd-controls position='0 1.5 -3'>
        <a-entity cursor="fuse: true; fuseTimeout: 500"
                  position="0 0 -1"
                  geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                  material="color: yellow; shader: flat">
        </a-entity>
      </a-entity>

    <!-- INTERACTIVE SIGNS -->
    <a-entity id='gravity-sign1'>
        <a-text color='gray'value="Now Interactable" geometry="primitive:plane" position='8 2 -2' width='3' height='2'></a-text>
    </a-entity>
    <a-entity id='gravity-sign2'>
      <a-text color='blue' value='Gravity +1' width='3' height='2' ></a-text>
    </a-entity>

    <!-- BOX CLUSTER -->
    <a-entity id="box-cluster">
      <a-box body='type: static' material='teal' color="teal" height='2' width='20' depth='20' position='0 1 -15'></a-box>
      <a-box body='type: static' color="teal" height='1' width='18' depth='18' position='0 2.5 -15'></a-box>
      <a-box body='type: static' color="teal" height='1' width='16' depth='16' position='0 3.5 -15'></a-box>
      <a-box body='type: static' color="teal" height='1' width='14' depth='14' position='0 4.5 -15'></a-box>
      <a-box body='type: static' color="teal" height='1' width='12' depth='12' position='0 5.5 -15'></a-box>
      <a-box body='type: static' color="teal" height='1' width='10' depth='10' position='0 6.5 -15'></a-box>
      <a-box body='type: static' color="teal" height='1' width='8' depth='8' position='0 7.5 -15'></a-box>
      <a-box body='type: static' color="teal" height='1' width='6' depth='6' position='0 8.5 -15'></a-box>
    </a-entity>
    <a-entity id="sky-spawner">
            <!-- <a-torus-knot arc="90" p="7" q="9" radius="3" radius-tubular="0.010" color="purple" position="-3 0.75 -3"></a-torus-knot>
      <a-torus-knot arc="90" p="7" q="9" radius="3" radius-tubular="0.010" color="purple" position="-2 0.75 -3"></a-torus-knot>
          <a-dodecahedron color="pink" radius="2" position="2 1 -3"></a-dodecahedron> -->
    </a-entity>

    <!-----------------SKY SPAWN----------------->
    <a-entity id="sphereSpawner"></a-entity>
    <a-entity id="chipSpawner"></a-entity>
    <a-sky color="white"></a-sky>

  <script>

    // -----------HELPERS---------- //
    $ = queryString => document.querySelector(queryString);
    const randomRange = (min, max) => {
      return Math.random() * (max - min) + min;
    }
    // -----------SPHERES----------- //
    const sphereSpawn = () => {
    for (let n = 0; n < 3; n++) {
      const sphere = document.createElement('a-sphere')
      $("#sphereSpawner").appendChild(sphere);
      sphere.setAttribute('bounce')
      const colors = ['red', 'lightcoral', 'pink', 'navy', 'green', 'orange']
      const color = `${colors[Math.floor(Math.random() * colors.length)]}`
      sphere.setAttribute("color", color);
      
      sphere.setAttribute("position", `${randomRange(-20, 20)} ${randomRange(9, 11)} ${randomRange(-20, -5)}`)
      
      sphere.setAttribute("body", "type: dynamic");
      }
    }
    setInterval(() => {
      sphereSpawn()
      const sphereSpawner = $('#sphereSpawner')
      while (sphereSpawner.childElementCount >= 150) {
          sphereSpawner.firstChild.remove();
        }
    }, 100)
    
  
    // ------------CHIPS-------------//
    const chipSpawn = () => {
    for (let n = 0; n < 3; n++) {
      const chip = document.createElement('a-cylinder')
      $('#chipSpawner').appendChild(chip);
      chip.setAttribute('bounce')
      chip.setAttribute('height', '.1')
      chip.setAttribute(
        "color",
        `hsl(${randomNum(360)}, ${randomNum(100)}%, ${randomNum(100)}%)`
      );
      chip.setAttribute(
        "position",
        `${randomRange(-20, 20)} ${randomRange(20, 40)} ${randomRange(-20, -5)}`
      );
      
      chip.setAttribute("body", "type: dynamic");
      console.log(chip)
      }
    }
    const chipSpawner = $('#chipSpawner')
    setInterval(() => {
      chipSpawn()
      while (chipSpawner.childElementCount > 50) {
        chipSpawner.firstChild.remove();
      }
      
    }, 200)
    
    
    
  // document.addEventListener('click', spawnAndThrowSticker, false)
  
  // function spawnAndThrowSticker(event) {
  //   let sticker = document.createElement('a-cylinder')
  //   createSticker(sticker)
  //   throwSticker(sticker)
  // }
  
  // function createSticker(sticker) {
  //   let spawner = document.querySelector('#sky-spawner')
  //   sticker.setAttribute('color', 'yellow')
  //   sticker.setAttribute('height', '0.01')
  //   sticker.setAttribute('radius', Math.random())
  //   sticker.setAttribute('position', `${_.random(-1, 1, true)}, ${_.random(-1, 1, true)}, ${_.random(-1, 1, true)}`)
  //   spawner.appendChild(sticker)
  //   sticker.setAttribute('dynamic-body', ' ')
  // }
  
  // function throwSticker(sticker) {
  //   sticker.body.applyImpulse(
  //     /* impulse */        new CANNON.Vec3(0, 1, -1),
  //     /* world position */ new CANNON.Vec3().copy(el.getComputedAttribute('position'))
  //   )
  // }

  //--------------FLOOR PLANES----------------//
  const floorBoard = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1];
    let floorStats = {
      width: 50,
      height: 50,
      depth: 50,
    };
    let floors = document.querySelector('#box-cluster')
    for (let i = 0; i < Math.sqrt(floorBoard.length); i++) {
      for (let j = 0; j < Math.sqrt(floorBoard.length); j++) {
        let pos_Z = (-1 * i * floorStats.height) - 4
        let pos_X = j * floorStats.width;
        const pos_Y = 1;
        
        let current = document.createElement("a-plane")
        floors.appendChild(current)
        current.setAttribute('body', 'type: static')
        current.setAttribute('rotation', '-90 0 0')
        current.setAttribute('width', `${floorStats.width}`)
        current.setAttribute('height', `${floorStats.height}`)
        floorBoard[i] == current.setAttribute('color', 'lightgray')
        current.setAttribute('position', `${pos_X} ${pos_Y} ${pos_Z}`)
        }
      }
    </script>
</a-scene>
    

<script>
    //-----------------------------------------LOAD AFTER A-SCENE------------------------------------------------//
document.querySelector('a-scene').addEventListener('render-target-loaded', () => {
})
  </script>
  

  </body>

</html>
